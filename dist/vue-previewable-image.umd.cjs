(function(w,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("vue"),require("viewerjs")):typeof define=="function"&&define.amd?define(["exports","vue","viewerjs"],r):(w=typeof globalThis!="undefined"?globalThis:w||self,r(w.VuePreviewableImage={},w.Vue,w.Viewer))})(this,function(w,r,I){"use strict";const P=(n,e=!0,l,o)=>{const u=r.ref(),f=r.ref(""),d=r.ref(!1),p=r.ref(!1),a=r.ref(!1),i=r.ref(!1),c=r.ref(),m=()=>{c.value=new IntersectionObserver(s=>{s.forEach(g=>{const{intersectionRatio:_,target:y}=g;if(_>0&&!y.classList.contains("lazy-loaded")){const t=new Image;i.value=!0,t.addEventListener("load",v=>{y.classList.add("lazy-loaded"),f.value=n,a.value=!0,d.value=!0,p.value=!1,i.value=!1,o&&o(v)}),t.addEventListener("error",v=>{y.classList.add("lazy-loaded"),a.value=!0,p.value=!0,d.value=!1,i.value=!1,l&&l(v)}),t.src=n}})},{threshold:[1]}),u.value&&c.value.observe(u.value)};return r.onMounted(()=>{e?m():f.value=n}),r.onUnmounted(()=>{var s;u.value&&((s=c.value)==null||s.unobserve(u.value))}),{lazySrc:f,lazyloadSuccess:d,lazyloadError:p,lazyloaded:a,lazyloading:i,lazyloadTrigger:u}};function x(n){return typeof n[0]=="string"}const L=r.defineComponent({name:"ImageViewer",model:{prop:"modelValue",event:"update:modelValue"},props:{modelValue:{type:Boolean,default:!1},currentPreviewIndex:{type:Number,default:0},previewSrcList:{type:Array,default:()=>[]},viewerOptions:{type:Object,default:()=>({})},viewerTitle:{type:Function,default:void 0},zIndex:{type:[Number,String],default:2015}},emits:["update:modelValue","update:currentPreviewIndex","switch"],setup(n,{emit:e}){const{modelValue:l,previewSrcList:o,currentPreviewIndex:u}=r.toRefs(n),f=r.computed(()=>o.value&&o.value.length>0),d=r.ref(),p=()=>{var t;(t=d.value)==null||t.view(i.value)};r.watch(l,t=>{t&&p()});const a=r.computed(()=>f.value?x(o.value)?o.value.map(t=>({src:t,alt:t})):o.value:[]),i=r.computed({get(){return u.value},set(t){e("update:currentPreviewIndex",t)}}),c=r.computed(()=>o.value.length||0),m=()=>{const t=document.createElement("div");return a.value.forEach(v=>{const h=new Image;Object.keys(v).forEach(b=>{h[b]=v[b]}),t.appendChild(h)}),t.addEventListener("view",v=>{const h=v;i.value=h.detail.index,e("switch",i.value,d.value)}),t.addEventListener("hidden",v=>{console.log(v),e("update:modelValue",!1)}),t},s=r.computed(()=>n.viewerTitle?t=>n.viewerTitle(t,{index:i.value,total:c.value}):t=>`${t.alt} (${i.value+1}/${c.value})`),g=r.computed(()=>Object.assign({title:s.value,zIndex:n.zIndex},n.viewerOptions)),_=()=>{f.value&&(d.value=new I(m(),g.value),l.value&&p())},y=()=>{_()};return r.onMounted(()=>{y()}),r.onUnmounted(()=>{var t;(t=d.value)==null||t.destroy()}),{hasPreviewList:f,PreviewListLength:c,finalPreviewSrcList:a,viewer:d,handleImgView:p}}}),F="";function z(n,e,l,o,u,f,d,p){var a=typeof n=="function"?n.options:n;e&&(a.render=e,a.staticRenderFns=l,a._compiled=!0),o&&(a.functional=!0),f&&(a._scopeId="data-v-"+f);var i;if(d?(i=function(s){s=s||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!s&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(s=__VUE_SSR_CONTEXT__),u&&u.call(this,s),s&&s._registeredComponents&&s._registeredComponents.add(d)},a._ssrRegister=i):u&&(i=p?function(){u.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:u),i)if(a.functional){a._injectStyles=i;var c=a.render;a.render=function(g,_){return i.call(_),c(g,_)}}else{var m=a.beforeCreate;a.beforeCreate=m?[].concat(m,i):[i]}return{exports:n,options:a}}var O=function(){var e=this,l=e._self._c;return e._self._setupProxy,l("div",{staticClass:"image-viewer"})},T=[],C=z(L,O,T,!1,null,"d75f567f",null,null);const S=C.exports,M="",E=r.defineComponent({name:"PreviewableImage",components:{ImageViewer:S},props:{width:{type:String,default:void 0},height:{type:String,default:void 0},src:{type:String,default:""},alt:{type:String,default:""},referrerPolicy:{type:String,default:void 0},fit:{type:String,default:"fill"},zIndex:{type:[Number,String],default:2015},previewSrcList:{type:Array,default:()=>[]},currentPreviewIndex:{type:Number,default:0},viewerOptions:{type:Object,default:()=>({})},viewerTitle:{type:Function,default:void 0},lazy:{type:Boolean,default:!0}},emits:["switch","update:currentPreviewIndex","load","error"],setup(n,{emit:e}){const{previewSrcList:l,currentPreviewIndex:o}=r.toRefs(n),u=r.computed(()=>({"--img-object-fit":n.fit})),{lazySrc:f,lazyloadTrigger:d,lazyloading:p,lazyloadError:a,lazyloadSuccess:i}=P(n.src,n.lazy,t=>{e("load",t)},t=>{e("error",t)}),c=r.computed(()=>l.value&&l.value.length>0),m=r.computed(()=>!(!c.value||n.lazy&&!i.value)),s=r.ref(!1),g=()=>{c.value&&(s.value=!0)},_=r.computed({get(){return o.value},set(t){e("update:currentPreviewIndex",t)}});return{lazyloadTrigger:d,imgStyleVars:u,hasPreviewList:c,lazySrc:f,lazyloading:p,lazyloadError:a,lazyloadSuccess:i,showImageViewer:s,handleImgView:g,currentViewerIndex:_,handleSwitch:(t,v)=>{e("switch",t,v)},initViewer:m}}}),U="";var $=function(){var e=this,l=e._self._c;return e._self._setupProxy,l("div",{ref:"lazyloadTrigger",staticClass:"previewable-image",style:[{width:e.width,height:e.height},e.imgStyleVars]},[e.lazy&&e.lazyloading?l("div",{staticClass:"previewable-image__placeholder"},[e._t("placeholder",function(){return[e._v("Loading...")]})],2):e.lazy&&e.lazyloadError?l("div",{staticClass:"previewable-image__error"},[e._t("error",function(){return[e._v("Load Error")]})],2):l("img",{class:["previewable-image__inner",{"previewable-image__preview":e.hasPreviewList}],attrs:{src:e.lazySrc,alt:e.alt,referrerpolicy:e.referrerPolicy},on:{click:e.handleImgView}}),e.initViewer?l("ImageViewer",{attrs:{"current-preview-index":e.currentViewerIndex,"preview-src-list":e.previewSrcList,"viewer-options":e.viewerOptions,"viewer-title":e.viewerTitle,"z-index":e.zIndex},on:{"update:currentPreviewIndex":function(o){e.currentViewerIndex=o},"update:current-preview-index":function(o){e.currentViewerIndex=o},switch:e.handleSwitch},model:{value:e.showImageViewer,callback:function(o){e.showImageViewer=o},expression:"showImageViewer"}}):e._e()],1)},R=[],j=z(E,$,R,!1,null,null,null,null);const V=j.exports,N={install:(n,e)=>{const l=Object.assign({componentName:V.name,defaultViewerOptions:{}},e);n.component(l.componentName,V),I.setDefaults(l.defaultViewerOptions)}};w.Viewer=I,w.ImageViewer=S,w.PreviewableImage=V,w.default=N,Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
