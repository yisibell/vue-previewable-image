(function(u,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue"),require("viewerjs")):typeof define=="function"&&define.amd?define(["exports","vue","viewerjs"],t):(u=typeof globalThis<"u"?globalThis:u||self,t(u.VuePreviewableImage={},u.Vue,u.Viewer))})(this,function(u,t,S){"use strict";const L=(n,e=!0,l,y)=>{const s=t.ref(),c=t.ref(""),f=t.ref(!1),w=t.ref(!1),a=t.ref(!1),i=t.ref(!1),g=t.ref(),v=()=>{g.value=new IntersectionObserver(o=>{o.forEach(d=>{const{intersectionRatio:_,target:p}=d;if(_>0&&!p.classList.contains("lazy-loaded")){const m=new Image;i.value=!0,m.addEventListener("load",h=>{p.classList.add("lazy-loaded"),c.value=n,a.value=!0,f.value=!0,w.value=!1,i.value=!1,y&&y(h)}),m.addEventListener("error",h=>{p.classList.add("lazy-loaded"),a.value=!0,w.value=!0,f.value=!1,i.value=!1,l&&l(h)}),m.src=n}})},{threshold:[1]}),s.value&&g.value.observe(s.value)};return t.onMounted(()=>{e?v():c.value=n}),t.onUnmounted(()=>{var o;s.value&&((o=g.value)==null||o.unobserve(s.value))}),{lazySrc:c,lazyloadSuccess:f,lazyloadError:w,lazyloaded:a,lazyloading:i,lazyloadTrigger:s}},U="";function T(n){return typeof n[0]=="string"}const C=t.defineComponent({name:"PreviewableImage",props:{width:{type:String,default:void 0},height:{type:String,default:void 0},src:{type:String,default:""},alt:{type:String,default:""},fit:{type:String,default:"fill"},previewSrcList:{type:Array,default:()=>[]},currentPreviewIndex:{type:Number,default:0},viewerOptions:{type:Object,default:()=>({})},viewerTitle:{type:Function,default:void 0},lazy:{type:Boolean,default:!0}},emits:["switch","update:currentPreviewIndex","load","error"],setup(n,{emit:e}){const{previewSrcList:l,currentPreviewIndex:y}=t.toRefs(n),{lazySrc:s,lazyloadTrigger:c,lazyloading:f,lazyloadError:w,lazyloadSuccess:a}=L(n.src,n.lazy,r=>{e("load",r)},r=>{e("error",r)}),i=t.ref(),g=t.computed(()=>({"--img-object-fit":n.fit})),v=t.computed(()=>l.value&&l.value.length>0),o=t.computed(()=>v.value?T(l.value)?l.value.map(r=>({src:r,alt:r})):l.value:[]),d=t.computed({get(){return y.value},set(r){e("update:currentPreviewIndex",r)}}),_=t.computed(()=>l.value.length||0),p=()=>{const r=document.createElement("div");return o.value.forEach(z=>{const b=new Image;Object.keys(z).forEach(P=>{b[P]=z[P]}),r.appendChild(b)}),r.addEventListener("view",z=>{const b=z;d.value=b.detail.index,e("switch",d.value,i.value)}),r},m=t.computed(()=>n.viewerTitle?r=>n.viewerTitle(r,{index:d.value,total:_.value}):r=>`${r.alt} (${d.value+1}/${_.value})`),h=t.computed(()=>Object.assign({title:m.value},n.viewerOptions)),I=()=>{v.value&&(n.lazy&&!a.value||(i.value=new S(p(),h.value)))};t.watch([a,l],()=>{I()},{deep:!0});const j=()=>{var r;(r=i.value)==null||r.view(d.value)},F=()=>{I()};return t.onMounted(()=>{F()}),t.onUnmounted(()=>{var r;(r=i.value)==null||r.destroy()}),{lazyloadTrigger:c,PreviewListLength:_,finalPreviewSrcList:o,imgStyleVars:g,viewer:i,handleImgView:j,hasPreviewList:v,lazySrc:s,lazyloading:f,lazyloadError:w}}}),M="";function E(n,e,l,y,s,c,f,w){var a=typeof n=="function"?n.options:n;e&&(a.render=e,a.staticRenderFns=l,a._compiled=!0),y&&(a.functional=!0),c&&(a._scopeId="data-v-"+c);var i;if(f?(i=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__<"u"&&(o=__VUE_SSR_CONTEXT__),s&&s.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(f)},a._ssrRegister=i):s&&(i=w?function(){s.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:s),i)if(a.functional){a._injectStyles=i;var g=a.render;a.render=function(d,_){return i.call(_),g(d,_)}}else{var v=a.beforeCreate;a.beforeCreate=v?[].concat(v,i):[i]}return{exports:n,options:a}}var V=function(){var e=this,l=e._self._c;return e._self._setupProxy,l("div",{ref:"lazyloadTrigger",staticClass:"previewable-image",style:[{width:e.width,height:e.height},e.imgStyleVars]},[e.lazy&&e.lazyloading?l("div",{staticClass:"previewable-image__placeholder"},[e._t("placeholder",function(){return[e._v("Loading...")]})],2):e.lazy&&e.lazyloadError?l("div",{staticClass:"previewable-image__error"},[e._t("error",function(){return[e._v("Load Error")]})],2):l("img",{class:["previewable-image__inner",{"previewable-image__preview":e.hasPreviewList}],attrs:{src:e.lazySrc,alt:e.alt},on:{click:e.handleImgView}})])},O=[],$=E(C,V,O,!1,null,null,null,null);const R=$.exports;u.Viewer=S,u.PreviewableImage=R,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
