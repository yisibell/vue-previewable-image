(function(l,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("viewerjs")):typeof define=="function"&&define.amd?define(["exports","vue","viewerjs"],e):(l=typeof globalThis<"u"?globalThis:l||self,e(l.VuePreviewableImage={},l.Vue,l.Viewer))})(this,function(l,e,I){"use strict";const E=(t,n=!0,a,s)=>{const i=e.ref(),f=e.ref(""),d=e.ref(!1),y=e.ref(!1),v=e.ref(!1),o=e.ref(!1),g=e.ref(),m=()=>{g.value=new IntersectionObserver(c=>{c.forEach(u=>{const{intersectionRatio:p,target:w}=u;if(p>0&&!w.classList.contains("lazy-loaded")){const h=new Image;o.value=!0,h.addEventListener("load",z=>{w.classList.add("lazy-loaded"),f.value=t,v.value=!0,d.value=!0,y.value=!1,o.value=!1,s&&s(z)}),h.addEventListener("error",z=>{w.classList.add("lazy-loaded"),v.value=!0,y.value=!0,d.value=!1,o.value=!1,a&&a(z)}),h.src=t}})},{threshold:[1]}),i.value&&g.value.observe(i.value)};return e.onMounted(()=>{n?m():f.value=t}),e.onUnmounted(()=>{var c;i.value&&((c=g.value)==null||c.unobserve(i.value))}),{lazySrc:f,lazyloadSuccess:d,lazyloadError:y,lazyloaded:v,lazyloading:o,lazyloadTrigger:i}},C="";function O(t){return typeof t[0]=="string"}const V=e.defineComponent({name:"PreviewableImage",props:{width:{type:String,default:void 0},height:{type:String,default:void 0},src:{type:String,default:""},alt:{type:String,default:""},referrerPolicy:{type:String,default:void 0},fit:{type:String,default:"fill"},zIndex:{type:[Number,String],default:2015},previewSrcList:{type:Array,default:()=>[]},currentPreviewIndex:{type:Number,default:0},viewerOptions:{type:Object,default:()=>({})},viewerTitle:{type:Function,default:void 0},lazy:{type:Boolean,default:!0}},emits:["switch","update:currentPreviewIndex","load","error"],setup(t,{emit:n}){const{previewSrcList:a,currentPreviewIndex:s}=e.toRefs(t),{lazySrc:i,lazyloadTrigger:f,lazyloading:d,lazyloadError:y,lazyloadSuccess:v}=E(t.src,t.lazy,r=>{n("load",r)},r=>{n("error",r)}),o=e.ref(),g=e.computed(()=>({"--img-object-fit":t.fit})),m=e.computed(()=>a.value&&a.value.length>0),c=e.computed(()=>m.value?O(a.value)?a.value.map(r=>({src:r,alt:r})):a.value:[]),u=e.computed({get(){return s.value},set(r){n("update:currentPreviewIndex",r)}}),p=e.computed(()=>a.value.length||0),w=()=>{const r=document.createElement("div");return c.value.forEach(S=>{const b=new Image;Object.keys(S).forEach(_=>{b[_]=S[_]}),r.appendChild(b)}),r.addEventListener("view",S=>{const b=S;u.value=b.detail.index,n("switch",u.value,o.value)}),r},h=e.computed(()=>t.viewerTitle?r=>t.viewerTitle(r,{index:u.value,total:p.value}):r=>`${r.alt} (${u.value+1}/${p.value})`),z=e.computed(()=>Object.assign({title:h.value,zIndex:t.zIndex},t.viewerOptions)),L=()=>{m.value&&(t.lazy&&!v.value||(o.value=new I(w(),z.value)))};e.watch([v,a],()=>{L()},{deep:!0});const M=()=>{var r;(r=o.value)==null||r.view(u.value)},q=()=>{L()};return e.onMounted(()=>{q()}),e.onUnmounted(()=>{var r;(r=o.value)==null||r.destroy()}),{lazyloadTrigger:f,PreviewListLength:p,finalPreviewSrcList:c,imgStyleVars:g,viewer:o,handleImgView:M,hasPreviewList:m,lazySrc:i,lazyloading:d,lazyloadError:y}}}),F="",k=(t,n)=>{const a=t.__vccOpts||t;for(const[s,i]of n)a[s]=i;return a},T={key:0,class:"previewable-image__placeholder"},j={key:1,class:"previewable-image__error"},B=["src","alt","referrerpolicy"];function $(t,n,a,s,i,f){return e.openBlock(),e.createElementBlock("div",{ref:"lazyloadTrigger",class:"previewable-image",style:e.normalizeStyle([{width:t.width,height:t.height},t.imgStyleVars])},[t.lazy&&t.lazyloading?(e.openBlock(),e.createElementBlock("div",T,[e.renderSlot(t.$slots,"placeholder",{},()=>[e.createTextVNode("Loading...")])])):t.lazy&&t.lazyloadError?(e.openBlock(),e.createElementBlock("div",j,[e.renderSlot(t.$slots,"error",{},()=>[e.createTextVNode("Load Error")])])):(e.openBlock(),e.createElementBlock("img",{key:2,src:t.lazySrc,alt:t.alt,referrerpolicy:t.referrerPolicy,class:e.normalizeClass(["previewable-image__inner",{"previewable-image__preview":t.hasPreviewList}]),onClick:n[0]||(n[0]=(...d)=>t.handleImgView&&t.handleImgView(...d))},null,10,B))],4)}const P=k(V,[["render",$]]),N={install:(t,n)=>{const a=Object.assign({componentName:P.name,defaultViewerOptions:{}},n);t.component(a.componentName,P),I.setDefaults(a.defaultViewerOptions)}};l.Viewer=I,l.PreviewableImage=P,l.default=N,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
