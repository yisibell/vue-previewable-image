(function(u,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue"),require("viewerjs")):typeof define=="function"&&define.amd?define(["exports","vue","viewerjs"],e):(u=typeof globalThis!="undefined"?globalThis:u||self,e(u.VuePreviewableImage={},u.Vue,u.Viewer))})(this,function(u,e,V){"use strict";const _=(t,n=!0,a,l)=>{const o=e.ref(),w=e.ref(""),s=e.ref(!1),i=e.ref(!1),v=e.ref(!1),d=e.ref(!1),f=e.ref(),g=()=>{f.value=new IntersectionObserver(p=>{p.forEach(y=>{const{intersectionRatio:h,target:m}=y;if(h>0&&!m.classList.contains("lazy-loaded")){const r=new Image;d.value=!0,r.addEventListener("load",c=>{m.classList.add("lazy-loaded"),w.value=t,v.value=!0,s.value=!0,i.value=!1,d.value=!1,l&&l(c)}),r.addEventListener("error",c=>{m.classList.add("lazy-loaded"),v.value=!0,i.value=!0,s.value=!1,d.value=!1,a&&a(c)}),r.src=t}})},{threshold:[1]}),o.value&&f.value.observe(o.value)};return e.onMounted(()=>{n?g():w.value=t}),e.onUnmounted(()=>{var p;o.value&&((p=f.value)==null||p.unobserve(o.value))}),{lazySrc:w,lazyloadSuccess:s,lazyloadError:i,lazyloaded:v,lazyloading:d,lazyloadTrigger:o}};function L(t){return typeof t[0]=="string"}const E=e.defineComponent({props:{modelValue:{type:Boolean,default:!1},currentPreviewIndex:{type:Number,default:0},previewSrcList:{type:Array,default:()=>[]},viewerOptions:{type:Object,default:()=>({})},viewerTitle:{type:Function,default:void 0},zIndex:{type:[Number,String],default:2015}},emits:["update:modelValue","update:currentPreviewIndex","switch"],setup(t,{emit:n}){const{modelValue:a,previewSrcList:l,currentPreviewIndex:o}=e.toRefs(t),w=e.computed(()=>l.value&&l.value.length>0),s=e.ref(),i=()=>{var r;(r=s.value)==null||r.view(d.value)};e.watch(a,r=>{r&&i()});const v=e.computed(()=>w.value?L(l.value)?l.value.map(r=>({src:r,alt:r})):l.value:[]),d=e.computed({get(){return o.value},set(r){n("update:currentPreviewIndex",r)}}),f=e.computed(()=>l.value.length||0),g=()=>{const r=document.createElement("div");return v.value.forEach(c=>{const I=new Image;Object.keys(c).forEach(P=>{I[P]=c[P]}),r.appendChild(I)}),r.addEventListener("view",c=>{const I=c;d.value=I.detail.index,n("switch",d.value,s.value)}),r.addEventListener("hidden",c=>{console.log(c),n("update:modelValue",!1)}),r},p=e.computed(()=>t.viewerTitle?r=>t.viewerTitle(r,{index:d.value,total:f.value}):r=>`${r.alt} (${d.value+1}/${f.value})`),y=e.computed(()=>Object.assign({title:p.value,zIndex:t.zIndex},t.viewerOptions)),h=()=>{w.value&&(s.value=new V(g(),y.value),a.value&&i())},m=()=>{h()};return e.onMounted(()=>{m()}),e.onUnmounted(()=>{var r;(r=s.value)==null||r.destroy()}),{hasPreviewList:w,PreviewListLength:f,finalPreviewSrcList:v,viewer:s,handleImgView:i}}}),C="",S=(t,n)=>{const a=t.__vccOpts||t;for(const[l,o]of n)a[l]=o;return a},O={class:"image-viewer"};function k(t,n,a,l,o,w){return e.openBlock(),e.createElementBlock("div",O)}const b=S(E,[["render",k],["__scopeId","data-v-2617510c"]]),M="",$=e.defineComponent({name:"PreviewableImage",components:{ImageViewer:b},props:{width:{type:String,default:void 0},height:{type:String,default:void 0},src:{type:String,default:""},alt:{type:String,default:""},referrerPolicy:{type:String,default:void 0},fit:{type:String,default:"fill"},zIndex:{type:[Number,String],default:2015},previewSrcList:{type:Array,default:()=>[]},currentPreviewIndex:{type:Number,default:0},viewerOptions:{type:Object,default:()=>({})},viewerTitle:{type:Function,default:void 0},lazy:{type:Boolean,default:!0}},emits:["switch","update:currentPreviewIndex","load","error"],setup(t,{emit:n}){const{previewSrcList:a,currentPreviewIndex:l}=e.toRefs(t),o=e.computed(()=>({"--img-object-fit":t.fit})),{lazySrc:w,lazyloadTrigger:s,lazyloading:i,lazyloadError:v,lazyloadSuccess:d}=_(t.src,t.lazy,r=>{n("load",r)},r=>{n("error",r)}),f=e.computed(()=>a.value&&a.value.length>0),g=e.computed(()=>!(!f.value||t.lazy&&!d.value)),p=e.ref(!1),y=()=>{f.value&&(p.value=!0)},h=e.computed({get(){return l.value},set(r){n("update:currentPreviewIndex",r)}});return{lazyloadTrigger:s,imgStyleVars:o,hasPreviewList:f,lazySrc:w,lazyloading:i,lazyloadError:v,lazyloadSuccess:d,showImageViewer:p,handleImgView:y,currentViewerIndex:h,handleSwitch:(r,c)=>{n("switch",r,c)},initViewer:g}}}),U="",B={key:0,class:"previewable-image__placeholder"},T={key:1,class:"previewable-image__error"},j=["src","alt","referrerpolicy"];function N(t,n,a,l,o,w){const s=e.resolveComponent("ImageViewer");return e.openBlock(),e.createElementBlock("div",{ref:"lazyloadTrigger",class:"previewable-image",style:e.normalizeStyle([{width:t.width,height:t.height},t.imgStyleVars])},[t.lazy&&t.lazyloading?(e.openBlock(),e.createElementBlock("div",B,[e.renderSlot(t.$slots,"placeholder",{},()=>[e.createTextVNode("Loading...")])])):t.lazy&&t.lazyloadError?(e.openBlock(),e.createElementBlock("div",T,[e.renderSlot(t.$slots,"error",{},()=>[e.createTextVNode("Load Error")])])):(e.openBlock(),e.createElementBlock("img",{key:2,src:t.lazySrc,alt:t.alt,referrerpolicy:t.referrerPolicy,class:e.normalizeClass(["previewable-image__inner",{"previewable-image__preview":t.hasPreviewList}]),onClick:n[0]||(n[0]=(...i)=>t.handleImgView&&t.handleImgView(...i))},null,10,j)),t.initViewer?(e.openBlock(),e.createBlock(s,{key:3,modelValue:t.showImageViewer,"onUpdate:modelValue":n[1]||(n[1]=i=>t.showImageViewer=i),"current-preview-index":t.currentViewerIndex,"onUpdate:currentPreviewIndex":n[2]||(n[2]=i=>t.currentViewerIndex=i),"preview-src-list":t.previewSrcList,"viewer-options":t.viewerOptions,"viewer-title":t.viewerTitle,"z-index":t.zIndex,onSwitch:t.handleSwitch},null,8,["modelValue","current-preview-index","preview-src-list","viewer-options","viewer-title","z-index","onSwitch"])):e.createCommentVNode("",!0)],4)}const z=S($,[["render",N]]),x={install:(t,n)=>{const a=Object.assign({componentName:z.name,defaultViewerOptions:{}},n);t.component(a.componentName,z),V.setDefaults(a.defaultViewerOptions)}};u.Viewer=V,u.ImageViewer=b,u.PreviewableImage=z,u.default=x,Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
