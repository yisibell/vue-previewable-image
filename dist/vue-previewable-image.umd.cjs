(function(d,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("viewerjs")):typeof define=="function"&&define.amd?define(["exports","vue","viewerjs"],e):(d=typeof globalThis<"u"?globalThis:d||self,e(d.VuePreviewableImage={},d.Vue,d.Viewer))})(this,function(d,e,h){"use strict";const S=(n,r=!0)=>{const a=e.ref(),w=e.ref(""),s=e.ref(!1),g=e.ref(!1),f=e.ref(!1),v=e.ref(!1),t=e.ref(),o=()=>{t.value=new IntersectionObserver(u=>{u.forEach(p=>{const{intersectionRatio:l,target:c}=p;if(l>0&&!c.classList.contains("lazy-loaded")){const _=new Image;v.value=!0,_.addEventListener("load",()=>{c.classList.add("lazy-loaded"),f.value=!0,w.value=n,s.value=!0,v.value=!1}),_.addEventListener("error",()=>{c.classList.add("lazy-loaded"),f.value=!0,g.value=!0,v.value=!1}),_.src=n}})},{threshold:[1]}),a.value&&t.value.observe(a.value)};return e.onMounted(()=>{r?o():w.value=n}),e.onUnmounted(()=>{var u;a.value&&((u=t.value)==null||u.unobserve(a.value))}),{lazySrc:w,lazyloadSuccess:s,lazyloadError:g,lazyloaded:f,lazyloading:v,lazyloadTrigger:a}},F="";function I(n){return typeof n[0]=="string"}const P=e.defineComponent({name:"PreviewableImage",props:{width:{type:String,default:void 0},height:{type:String,default:void 0},src:{type:String,default:""},alt:{type:String,default:""},fit:{type:String,default:"fill"},previewSrcList:{type:Array,default:()=>[]},currentPreviewIndex:{type:Number,default:0},viewerOptions:{type:Object,default:()=>({})},viewerTitle:{type:Function,default:void 0},lazy:{type:Boolean,default:!0}},emits:["switch","update:currentPreviewIndex"],setup(n,{emit:r}){const{previewSrcList:a,currentPreviewIndex:w}=e.toRefs(n),{lazySrc:s,lazyloadTrigger:g,lazyloading:f,lazyloadError:v}=S(n.src,n.lazy),t=e.ref(),o=e.computed(()=>({"--img-object-fit":n.fit})),u=e.computed(()=>a.value&&a.value.length>0),p=e.computed(()=>u.value?I(a.value)?a.value.map(i=>({src:i,alt:i})):a.value:[]),l=e.computed({get(){return w.value},set(i){r("update:currentPreviewIndex",i)}}),c=e.computed(()=>a.value.length||0),_=()=>{const i=document.createElement("div");return p.value.forEach(m=>{const y=new Image;Object.keys(m).forEach(z=>{y[z]=m[z]}),i.appendChild(y)}),i.addEventListener("view",m=>{const y=m;l.value=y.detail.index,r("switch",l.value,t.value)}),i},O=e.computed(()=>n.viewerTitle?i=>n.viewerTitle(i,{index:l.value,total:c.value}):i=>`${i.alt} (${l.value+1}/${c.value})`),$=e.computed(()=>Object.assign({title:O.value},n.viewerOptions)),b=()=>{u.value&&(t.value=new h(_(),$.value))};e.watch(a,()=>{b()},{deep:!0});const R=()=>{var i;(i=t.value)==null||i.view(l.value)},j=()=>{b()};return e.onMounted(()=>{j()}),e.onUnmounted(()=>{var i;(i=t.value)==null||i.destroy()}),{lazyloadTrigger:g,PreviewListLength:c,finalPreviewSrcList:p,imgStyleVars:o,viewer:t,handleImgView:R,hasPreviewList:u,lazySrc:s,lazyloading:f,lazyloadError:v}}}),U="";function L(n,r,a,w,s,g,f,v){var t=typeof n=="function"?n.options:n;r&&(t.render=r,t.staticRenderFns=a,t._compiled=!0),w&&(t.functional=!0),g&&(t._scopeId="data-v-"+g);var o;if(f?(o=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__<"u"&&(l=__VUE_SSR_CONTEXT__),s&&s.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(f)},t._ssrRegister=o):s&&(o=v?function(){s.call(this,(t.functional?this.parent:this).$root.$options.shadowRoot)}:s),o)if(t.functional){t._injectStyles=o;var u=t.render;t.render=function(c,_){return o.call(_),u(c,_)}}else{var p=t.beforeCreate;t.beforeCreate=p?[].concat(p,o):[o]}return{exports:n,options:t}}var C=function(){var r=this,a=r._self._c;return r._self._setupProxy,a("div",{ref:"lazyloadTrigger",staticClass:"previewable-image",style:[{width:r.width,height:r.height},r.imgStyleVars]},[r.lazyloading?a("div",{staticClass:"previewable-image__placeholder"},[r._t("placeholder",function(){return[r._v("Loading...")]})],2):r.lazyloadError?a("div",{staticClass:"previewable-image__error"},[r._t("error",function(){return[r._v("Load Error")]})],2):a("img",{class:["previewable-image__inner",{"previewable-image__preview":r.hasPreviewList}],attrs:{src:r.lazySrc,alt:r.alt},on:{click:r.handleImgView}})])},T=[],E=L(P,C,T,!1,null,null,null,null);const V=E.exports;d.Viewer=h,d.PreviewableImage=V,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
